# 【作品タイトル】StrapStriker

![TopImage](Docs/StrapStriker_MainVisual.png)

## 📖 作品概要
満員電車で通勤通学中、周りの乗客全員ぶっ飛ばせたらな――そう思ったことはないだろうか。
本作品はそんな願いを叶える反倫理的で暴力的な爽快アクションである。プレイヤーは本物のつり革を掴んで動かし、ひねくれ者の新社会人堕天使・ストラを操る。
つり革を掴んで勢いをつけ、手を離して蹴り飛ばす！　誰もが見たことあって誰も遊んだことのない斬新なコントローラーで、思いのままに乗客を蹴散らし“快適”な通勤をめざせ！


* **制作人数:** 6人（ディレクター1名、進行管理1名、プログラマ2名、デザイナー1名、サウンド1名）
* **制作期間:** 2025年6月〜（現在も開発中）
* **自分の担当:** プログラムの90%以上
    * ゲーム全体の進行制御
    * プレイヤーの操作制御
    * NPCのスポーン制御

## 🎥 デモ / スクリーンショット
### プレイ画面 (GIF)
![Image](Docs/2025-12-1116-59-19-ezgif.com-video-to-gif-converter.gif)
> 車両内のNPCたちをぶっ飛ばすシーン

![Image](Docs/StrapStrikerPlayClip-ezgif.com-video-to-gif-converter.gif)
> 実際の筐体の様子

### プレイ動画 (YouTube)
https://youtu.be/abLYPbKq8iE

## 💻 技術的なこだわり

### 1. 堅牢な非同期シリアル通信基盤 (ArduinoInputManager)
Unityのメインスレッドを阻害しないよう設計された、独自コントローラーとの通信管理クラスです。
**「展示会でのトラブルゼロ」と「パフォーマンスの維持」**を念頭に置いてに設計しており、ハードウェア環境が不安定な状況でもゲームプレイを止めない工夫を凝らしています。

* **受信処理のマルチスレッド化**
  ブロッキングが発生するシリアル通信処理を別スレッドに分離し、メインスレッドへの負荷を完全に排除。`volatile`修飾子によるメモリ可視性の保証を行い、スレッドセーフかつ高速なデータの受け渡しを実現しています。
* **「手触り」を向上させる信号処理フィルタ**
  ハードウェア特有のスパイクノイズを除去するため、線形補間（`Mathf.Lerp`）によるスムージング処理を実装。生データをそのまま使うのではなく、ゲームの手触りとして「気持ち良い」挙動になるよう、プログラム側で入力を正規化しています。
* **実運用を想定した外部コンフィグ機能**
  展示会場でのPC変更やポート番号の変動に即座に対応できるよう、再ビルド不要で設定変更可能な外部テキストファイル読み込み機能を実装。ファイル自動生成機能も備え、設営時のセットアップ時間を大幅に短縮しました。
  * **Arduinoの入力を処理するスクリプト:** [📄 ArduinoInputManager.cs](https://github.com/Menae/StrapStriker/blob/main/Assets/_Scripts/Managers/ArduinoInputManager.cs)  

---

### 2. 物理演算とセンサー融合による「体感」の再現 (PlayerController)
Joy-Conのジャイロセンサー（角度・角速度）とArduinoの圧力センサー（握力）を統合し、**「つり革の振りがそのまま物理エネルギーに変換される」**コアメカニクスを実装しました。
物理演算ならではの挙動の納得感と、ゲームとしての遊びやすさのバランス調整に注力しています。

* **物理ベースの「スイング」挙動実装**
  単純なアニメーション再生ではなく、Rigidbody2Dへのトルク（`AddTorque`）入力によって振り子運動を制御。Joy-Conを振るタイミングと角度が合った時のみ運動エネルギー（`swayPower`）が増幅されるロジックを組み、「上手く漕げた時の加速感」をより感じられるように心がけました。
* **センサーノイズを吸収するUX設計（コヨーテタイム）**
  自作デバイス特有の「一瞬の信号途切れ」による意図しない入力を防ぐため、入力信号が0になっても数フレーム間は判定を維持する「猶予期間」を実装。ハードウェアの不安定さをソフトウェア側で吸収し、ストレスのない操作性を実現しています。
* **ステートマシンによる物理制約の動的管理**
  「掴み（HingeJoint接続）」「空中移動（慣性移動）」「着地（摩擦制御）」といった異なる物理状態をステートマシンで厳格に管理。状態遷移に合わせてRigidbodyの制約を動的に切り替えることで、バグの起きにくい堅牢な挙動制御を行っています。
  * **Playerの挙動を担当するスクリプト:** [📄 PlayerController.cs](https://github.com/Menae/StrapStriker/blob/main/Assets/_Scripts/Player/PlayerController.cs)

---

### 3. データ駆動型の進行管理と物理連動 (StageManager)
ゲームの進行を時系列で管理し、環境変化を物理エンジン全体へ伝播させる司令塔クラスです。
開発効率と演出の整合性を重視した設計を行っています。

* **Inspector完結のレベルデザイン基盤**
  駅のパラメータ（到着時間、駅の数、敵出現数、背景画像）を構造体として定義し、リスト化して管理。コードを修正することなく、Inspector上でステージ構成や難易度曲線を直感的に調整できる「データ駆動」な設計を採用し、バランス調整のサイクルを高速化しました。
* **コルーチンによるシーケンス制御**
  「減速→停車→ドア開閉→敵スポーン→加速」という複雑な時系列イベントを、`Update`メソッドでのフラグ管理ではなくコルーチン（`IEnumerator`）で記述。非同期的なイベントの流れを可読性の高いコードで管理し、演出のタイミング調整を容易にしています。
* **環境変化（慣性）のグローバル展開**
  電車の「加速・減速」を単なるUI演出で終わらせず、物理ベクトル（`CurrentInertia`）として数値化し、グローバルに公開。プレイヤーや敵キャラクターのコントローラーがこの値を参照することで、「急ブレーキで体がよろめく」といった物理挙動をシステム全体で同期させています。
    * **ステージの構成を担当するスクリプト: **[📄 StageManager.cs](https://github.com/Menae/StrapStriker/blob/main/Assets/_Scripts/Managers/StageManager.cs)  

## 🔧 使用技術・環境
* **Engine:** Unity 2022.3.18f1
* **Language:** C#, C++ (Arduino)
* **IDE:** Visual Studio 2022
* **Tools:** Git, GitHub

## 🚀 インストール・遊び方

**【動作環境】**
* **OS:** Windows 10 / 11
* **必須デバイス:** 自作つり革コントローラー (Arduino) + Joy-Con

**⚠️ ビルド済みアプリ（Releases）について**
配布している `StrapStriker_v0.66` は特殊筐体でのプレイを前提としたビルドのため、**コントローラーを接続しない環境では正常に動作しません。**

**【PCのみで動作確認を行う場合】**
特殊コントローラーなしでゲームロジックや動作を確認されたい場合は、リポジトリをクローンした上で、Scenesフォルダ内のSceen1を開き、ヒエラルキーからCharacters->Playerのインスペクタから最下部のDebug Modeをにチェックを入れることで、A/Dキー + スペースでの操作可能がなります。

1. 本リポジトリを `Clone` または `Download ZIP` してください。
2. **Unity 2022.3.18f1** でプロジェクトを開きます。
    * ※本来の「つり革を振る」体験とは異なりますが、ゲーム進行やロジックの確認が可能です。
